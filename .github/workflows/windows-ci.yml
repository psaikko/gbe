name: windows-ci
on:
  push:
    paths:
      - '.github/workflows/windows-ci.yml'
      - 'src/**.cpp'
      - 'include/**.h'
      - 'CMakeLists.txt'
jobs:
  build-library:
        runs-on: windows-latest
        steps:
        - uses: actions/checkout@v3

        - name: Get cmake
          uses: lukka/get-cmake@v3.21.1

        - name: Add msbuild to PATH
          uses: microsoft/setup-msbuild@v1.1

        - name: Setup vcpkg
          run: |
            git submodule update --init vcpkg
            .\vcpkg\bootstrap-vcpkg.bat

        - name: Cache vcpkg dependencies
          uses: actions/cache@v3
          env:
            cache-name: cache-vcpkg-deps
          with:
            path: .\vcpkg\installed
            key: test

        - name: Install dependencies
          run: .\vcpkg\vcpkg.exe install glfw3 glew glm openal-soft freealut getopt --triplet=x64-windows

        - name: Run cmake
          run: cmake.exe -DCMAKE_CONFIGURATION_TYPES=Release -S. -B.\build

        - name: Build library
          run: MSBuild.exe .\build\libgbe.sln

        - name: Upload library artifact
          uses: actions/upload-artifact@v3
          with:
            name: libgbe.lib
            path: ./build/Release/libgbe.lib

        - name: Build executable
          run: MSBuild.exe .\build\gbe.sln
